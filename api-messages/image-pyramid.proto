syntax = "proto3";
option go_package = ".;protos";

import "scan-beam-location.proto";


// Axis aligned bounding cube
message AABB
{
    Coordinate3D min = 1;
    Coordinate3D max = 2;
}

// 3D polygon
message Polygon3D
{
    repeated Coordinate3D vertexes = 1;
    AABB bounds = 2;
}

// The basic structure for the tile containing:
// - A list of images for the element maps 
// - Points representing locations we have data from
// - Polygons generated to display the point data in a map layer
// - Summary information like the bounding volume
message ImageTileStructure
{
    ImageTileSummary summary = 1;
    repeated Coordinate3D points = 2;
    repeated Polygon3D polygons = 3;
}

// Data values we have for a tile. Each tile stores an array of these
// containing ints OR floats. This can be used to generate colours to
// display on polygons on the tile
message ImageTileData
{
    repeated float fValues = 1;
    repeated int32 iValues = 2;
}

message ImageTileSummary
{
    AABB bounds = 1; // Tile bounding box

    uint32 points = 2; // How many points this tile has
    uint32 polygons = 3; // How many polygons this tile has
}

message ImagePyramidLayer
{
    AABB bounds = 1; // Bounding box of the entire layer

    uint16 tilesWide = 3;
    uint16 tilesHigh = 4;

    repeated ImageTileSummary tiles = 2;
}

message ImagePyramid
{
    AABB bounds = 1;

    repeated ImagePyramidLayer pyramid = 2;

    uint32 tileSize = 4; // Size of each tile in pixels
}

message ImagePyramidDBEntry
{
    string id = 1; // @gotags: bson:"_id,omitempty"
    ImagePyramid pyramid = 2;
}